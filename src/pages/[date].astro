---
import Layout from '../layouts/Layout.astro';
import fs from 'fs';
import path from 'path';

export function getStaticPaths() {
  const dataDir = path.join(process.cwd(), "data");

  return fs
    .readdirSync(dataDir)
    .filter((f) => f.endsWith(".json"))
    .filter((f) => f !== "index.json")
    .map((f) => ({
      params: { date: f.replace(".json", "") },
    }));
}

const { date } = Astro.params;
const dataDir = path.join(process.cwd(), "data");

const news = JSON.parse(
  fs.readFileSync(path.join(dataDir, `${date}.json`), "utf-8")
);
---

<Layout title={date}>
  <main>
    <header className="text-center">
      <a href="/" class="back-link">← Back to latest</a>
      <h1 class="page-title">Daily News</h1>
      <p class="date-subtitle">{date}</p>
    </header>

    <section>
      {news.stories.map((story, index) => (
        <article key={story.id} class="news-article">
          <h2 class="news-heading">{story.title}</h2>
          <p class="meta-info">
            {story.date_line} • {story.location}
          </p>

          <div class="news-content">
            {story.section.map((para, i) => (
              <p>{para}</p>
            ))}
          </div>

          <div class="why-it-matters">
            <span class="why-label">Why it matters</span>
            <p>{story.why_it_matters}</p>
          </div>
        </article>
      ))}
    </section>
  </main>
</Layout>
