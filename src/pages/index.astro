---
import Layout from '../layouts/Layout.astro';
import fs from 'fs';
import path from 'path';

const dataDir = path.join(process.cwd(), "data");

const index = JSON.parse(
  fs.readFileSync(path.join(dataDir, "index.json"), "utf-8")
);
const latestDate = index.latest;

const news = JSON.parse(
  fs.readFileSync(path.join(dataDir, `${latestDate}.json`), "utf-8")
);

const archiveDates = fs
  .readdirSync(dataDir)
  .filter((f) => f.endsWith(".json"))
  .filter((f) => f !== "index.json")
  .map((f) => f.replace(".json", ""))
  .filter((d) => d !== latestDate)
  .sort()
  .reverse()
  .slice(0, 5);
---

<Layout>
  <main>
    {/* Header */}
    <header className="text-center" style="margin-bottom: 3rem;">
      <h1 class="page-title">Kids News & Activities</h1>
      <p class="text-muted">
        Calm, friendly stories for kids aged 6–9 · Updated daily
      </p>
    </header>

    {/* Stories */}
    <section>
      {news.stories.map((story, index) => (
        <article key={story.id} class="news-article">
          <h2 class="news-heading">{story.title}</h2>

          <p class="meta-info">
            <span style="color: var(--color-accent);">Today</span>
            {" • "}
            {story.location}
          </p>

          <div class="news-content">
            {story.section.map((para, i) => (
              <p>{para}</p>
            ))}
          </div>

          <div class="why-it-matters">
            <span class="why-label">Why it matters</span>
            <p>{story.why_it_matters}</p>
          </div>
        </article>
      ))}
    </section>

    {/* Archives */}
    {archiveDates.length > 0 && (
      <footer class="archive-footer">
        <h3 class="archive-title">Past days</h3>
        <ul class="archive-list">
          {archiveDates.map((date) => (
            <li>
              <a href={`/${date}/`} class="archive-link">
                {date}
              </a>
            </li>
          ))}
        </ul>
      </footer>
    )}
  </main>
</Layout>
